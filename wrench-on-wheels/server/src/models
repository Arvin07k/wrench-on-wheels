import mongoose from 'mongoose';

const userSchema = new mongoose.Schema({
    email: { type: String, required: true, unique: true },
    passwordHash: { type: String, required: true },
    role: { type: String, enum: ['customer', 'mechanic'], required: true },
    stripeCustomerId: { type: String },
});

const carSchema = new mongoose.Schema({
    ownerId: { type: mongoose.Schema.Types.ObjectId, ref: 'User', required: true },
    make: { type: String, required: true },
    model: { type: String, required: true },
    year: { type: Number, required: true },
});

const serviceSchema = new mongoose.Schema({
    tier: { type: String, enum: ['premium', 'normal', 'cheap'], required: true },
    name: { type: String, required: true },
    description: { type: String },
    basePrice: { type: Number, required: true },
});

const mechanicSchema = new mongoose.Schema({
    userId: { type: mongoose.Schema.Types.ObjectId, ref: 'User', required: true },
    isVerified: { type: Boolean, default: false },
    skills: { type: [String], required: true },
    currentLocation: { type: { type: String, enum: ['Point'], required: true }, coordinates: { type: [Number], required: true } },
    availability: { type: Object, required: true },
});

const bookingSchema = new mongoose.Schema({
    customerId: { type: mongoose.Schema.Types.ObjectId, ref: 'User', required: true },
    carId: { type: mongoose.Schema.Types.ObjectId, ref: 'Car', required: true },
    serviceId: { type: mongoose.Schema.Types.ObjectId, ref: 'Service', required: true },
    mechanicId: { type: mongoose.Schema.Types.ObjectId, ref: 'Mechanic', default: null },
    status: { type: String, enum: ['pending', 'confirmed', 'en-route', 'in-progress', 'completed', 'canceled'], required: true },
    scheduledTime: { type: Date, required: true },
    address: { type: String, required: true },
    price: { type: Number, required: true },
});

export const User = mongoose.model('User', userSchema);
export const Car = mongoose.model('Car', carSchema);
export const Service = mongoose.model('Service', serviceSchema);
export const Mechanic = mongoose.model('Mechanic', mechanicSchema);
export const Booking = mongoose.model('Booking', bookingSchema);